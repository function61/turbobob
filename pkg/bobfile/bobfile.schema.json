{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "https://github.com/function61/turbobob/pkg/bobfile/bobfile",
    "$ref": "#/$defs/Bobfile",
    "$defs": {
        "Bobfile": {
            "properties": {
                "$schema": {
                    "type": "string",
                    "description": "JSON schema URL"
                },
                "for_description_of_this_file_see": {
                    "type": "string",
                    "description": "link which explains what this file is about"
                },
                "version_major": {
                    "type": "integer",
                    "description": "major version, for indicating backwards-incompatible version breaks"
                },
                "project_name": {
                    "type": "string",
                    "description": "the project's name, prefer filesystem-safe \u0026 URL-safe characters"
                },
                "meta": {
                    "$ref": "#/$defs/ProjectMetadata",
                    "description": "metadata about this project"
                },
                "builders": {
                    "items": {
                        "$ref": "#/$defs/BuilderSpec"
                    },
                    "type": "array",
                    "description": "builders used to build components of this project"
                },
                "docker_images": {
                    "items": {
                        "$ref": "#/$defs/DockerImageSpec"
                    },
                    "type": "array",
                    "description": "container images to build during the build"
                },
                "subrepos": {
                    "items": {
                        "$ref": "#/$defs/SubrepoSpec"
                    },
                    "type": "array",
                    "description": "subrepos to check out"
                },
                "os_arches": {
                    "$ref": "#/$defs/OsArchesSpec",
                    "description": "operating systems and CPU architectures to build for"
                },
                "experiments_i_consent_to_breakage": {
                    "$ref": "#/$defs/experiments",
                    "description": "unstable experiments to enable. by defining any of these, you consent to your builds breaking on new versions of Turbo Bob."
                },
                "project_emoji_icon": {
                    "type": "string",
                    "description": "moved to `ProjectMetadata`"
                }
            },
            "additionalProperties": false,
            "type": "object",
            "required": [
                "$schema",
                "for_description_of_this_file_see",
                "version_major",
                "project_name",
                "builders"
            ]
        },
        "BuilderCommands": {
            "properties": {
                "prepare": {
                    "items": {
                        "type": "string"
                    },
                    "type": "array",
                    "description": "command for preparing the build"
                },
                "build": {
                    "items": {
                        "type": "string"
                    },
                    "type": "array",
                    "description": "command for building the project"
                },
                "publish": {
                    "items": {
                        "type": "string"
                    },
                    "type": "array",
                    "description": "command for publishing the artefacts of the project"
                },
                "dev": {
                    "items": {
                        "type": "string"
                    },
                    "type": "array",
                    "description": "command for entering the development shell of the project"
                }
            },
            "additionalProperties": false,
            "type": "object",
            "required": [
                "build",
                "dev"
            ],
            "description": "Suppose you have three builders: 1) backend, 2) frontend and 3) documentation."
        },
        "BuilderSpec": {
            "properties": {
                "name": {
                    "type": "string",
                    "description": "name of the builder",
                    "examples": [
                        "default",
                        "backend"
                    ]
                },
                "uses": {
                    "type": "string",
                    "description": "image used for container of this builder",
                    "examples": [
                        "docker://alpine:latest",
                        "dockerfile://build-default.Dockerfile"
                    ]
                },
                "mount_source": {
                    "type": "string"
                },
                "mount_destination": {
                    "type": "string"
                },
                "workdir": {
                    "type": "string"
                },
                "commands": {
                    "$ref": "#/$defs/BuilderCommands",
                    "description": "commands used to build / develop / etc. the project"
                },
                "dev_ports": {
                    "items": {
                        "type": "string"
                    },
                    "type": "array"
                },
                "dev_http_ingress": {
                    "type": "string",
                    "examples": [
                        "80"
                    ]
                },
                "dev_pro_tips": {
                    "items": {
                        "type": "string"
                    },
                    "type": "array",
                    "description": "pro-tips e.g. commands the user can run inside the builder to lint / launch / etc. the project"
                },
                "dev_shell_commands": {
                    "items": {
                        "$ref": "#/$defs/DevShellCommand"
                    },
                    "type": "array",
                    "description": "injected as history for quick recall (ctrl + r)"
                },
                "env": {
                    "additionalProperties": {
                        "type": "string"
                    },
                    "type": "object"
                },
                "pass_envs": {
                    "items": {
                        "type": "string"
                    },
                    "type": "array"
                },
                "contextless_build": {
                    "type": "boolean",
                    "description": "(DEPRECATED) build without uploading any files to the build context"
                }
            },
            "additionalProperties": false,
            "type": "object",
            "required": [
                "name",
                "uses",
                "mount_destination",
                "commands"
            ]
        },
        "DevShellCommand": {
            "properties": {
                "command": {
                    "type": "string",
                    "description": "command to run to achieve the specific task"
                },
                "important": {
                    "type": "boolean",
                    "description": "important commands are shown as pro-tips on \"$ bob dev\""
                }
            },
            "additionalProperties": false,
            "type": "object",
            "required": [
                "command",
                "important"
            ]
        },
        "DockerImageSpec": {
            "properties": {
                "image": {
                    "type": "string",
                    "description": "image ref (without the tag) to which to push the image",
                    "examples": [
                        "myorg/myproject"
                    ]
                },
                "dockerfile_path": {
                    "type": "string",
                    "description": "where to find the `Dockerfile` from",
                    "examples": [
                        "Dockerfile"
                    ]
                },
                "auth_type": {
                    "type": "string",
                    "description": "creds_from_env"
                },
                "platforms": {
                    "items": {
                        "type": "string"
                    },
                    "type": "array",
                    "description": "platforms to build for, in `$ docker build --platform=...` syntax"
                },
                "tag_latest": {
                    "type": "boolean",
                    "description": "whether to publish the `:latest` tag"
                }
            },
            "additionalProperties": false,
            "type": "object",
            "required": [
                "image",
                "dockerfile_path",
                "auth_type",
                "tag_latest"
            ]
        },
        "OsArchesSpec": {
            "properties": {
                "neutral": {
                    "type": "boolean",
                    "description": "works across all OSes and arches, example: native JavaScript project or a website"
                },
                "linux-neutral": {
                    "type": "boolean",
                    "description": "works on Linux, arch doesn't matter"
                },
                "linux-amd64": {
                    "type": "boolean"
                },
                "linux-arm": {
                    "type": "boolean"
                },
                "linux-arm64": {
                    "type": "boolean"
                },
                "linux-riscv64": {
                    "type": "boolean"
                },
                "windows-neutral": {
                    "type": "boolean",
                    "description": "works on Windows, arch doesn't matter"
                },
                "windows-amd64": {
                    "type": "boolean"
                },
                "darwin-amd64": {
                    "type": "boolean"
                }
            },
            "additionalProperties": false,
            "type": "object",
            "required": [
                "neutral",
                "linux-neutral",
                "linux-amd64",
                "linux-arm",
                "linux-arm64",
                "linux-riscv64",
                "windows-neutral",
                "windows-amd64",
                "darwin-amd64"
            ],
            "description": "documents os/arch combos which this project's build artefacts support."
        },
        "ProjectMetadata": {
            "properties": {
                "description": {
                    "type": "string",
                    "description": "what this project is used for"
                },
                "website": {
                    "type": "string",
                    "description": "URL of homepage or such"
                },
                "documentation": {
                    "type": "string",
                    "description": "URL of documentation website"
                },
                "project_emoji_icon": {
                    "type": "string",
                    "description": "to quickly differentiate projects in e.g. workspace switcher"
                }
            },
            "additionalProperties": false,
            "type": "object"
        },
        "SubrepoSpec": {
            "properties": {
                "source": {
                    "type": "string"
                },
                "kind": {
                    "type": "string"
                },
                "destination": {
                    "type": "string"
                },
                "revision": {
                    "type": "string"
                }
            },
            "additionalProperties": false,
            "type": "object",
            "required": [
                "source",
                "kind",
                "destination",
                "revision"
            ]
        },
        "experiments": {
            "properties": {
                "prepare_step": {
                    "type": "boolean"
                }
            },
            "additionalProperties": false,
            "type": "object"
        }
    }
}
